---
layout: post
title: Installing gapps in Visual Studio Android Emulator (Marshmallow)
date: '2016-04-05T22:34:00.001+02:00'
author: Tomasz Cielecki
tags:
- Visual Studio
- Xamarin.Android
modified_time: '2017-05-29T07:59:37.546+02:00'
thumbnail: https://2.bp.blogspot.com/-QWhEzxZQS3c/VwQcw1794zI/AAAAAAAADls/RP83Itk48kU-MaiWGCUbNi42r-qT9biaA/s72-c/1.PNG
blogger_id: tag:blogger.com,1999:blog-3433282516380174051.post-5167256542132544933
blogger_orig_url: http://blog.ostebaronen.dk/2016/04/installing-gapps-in-visual-studio.html
---

<blockquote class="tr_bq"><b>29/5/2017:</b> Visual Studio Android Emulator has been discontinued. Microsoft recommends using the Emulator Images that Google provides. The Google images rely on HAXM as described below, so no AMD support and you can't run it with Hyper-V running at the same time.</blockquote><br />The images Google provides in the Android SDK are all great and work fine if you have Intel HAXM installed on the machine. However, a lot of developers using Visual Studio, also use Hyper-V to run Windows device emulators. This means Intel HAXM doesn't work and in turn means that the x86 images from Google won't run because there is another hypervisor running.<br /><br />Microsoft have been so kind to provide the Visual Studio Android Emulator which uses Hyper-V as hypervisor and does not require you to reboot your machine every time you want to switch between using Hyper-V and another hypervisor. Great!<br /><br />There is one caveat. None of the images included in the Visual Studio Android Emulator tools have Google Play Services installed. Hence, you have to install them yourself. It turned out to be more complicated than I thought it would. Hence, I am documenting it in this blog post.<br /><br />At first I tried the tried and great OpenGapps, which a lot of custom roms for Android devices recommend using. Picked x86 and the pico package for Android M and tried to install that on a Marshmallow image. It just threw an error telling me that the <i>system/</i>&nbsp;folder was missing in the zip. Great, what then? I tried adding that folder with an empty file manually to the zip, as it seems it doesn't care whether the zip is signed or not when installing. This made the zip install. Well not really, no Play Store or Play Services where actually installed.<br /><br />I tried some other GAPPS zips from various sources, none of them seemed to work. I searched around without finding any solution.<br /><br /><a href="https://twitter.com/alexandrechohfi">Alexandre Chohfi</a> over at the <a href="http://xamarinchat.herokuapp.com/">Xamarin Community Slack</a> pointed out that he had the same issues with Genymotion, which runs on VirtualBox and pointed me in the direction of <a href="https://gist.github.com/wbroek/9321145" target="_blank">this gist explaining how to do it on Genymotion</a>. Following the <a href="https://gist.github.com/wbroek/9321145#gistcomment-1740247" target="_blank">instructions from arcao in the comments</a> works! Without installing that Genymotion ARM translation package too.<br /><br /><h3><b>Steps I used</b></h3><h4>Prerequisites</h4><b>1.</b> Install a Marshmallow image in the <a href="https://www.visualstudio.com/en-us/features/msft-android-emulator-vs.aspx" target="_blank">Visual Studio Emulator for Android tools</a> (can be opened through <b><i>Tools &gt; Visual Studio Emulator for Android</i></b> in Visual Studio)<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-QWhEzxZQS3c/VwQcw1794zI/AAAAAAAADls/RP83Itk48kU-MaiWGCUbNi42r-qT9biaA/s1600/1.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="376" src="https://2.bp.blogspot.com/-QWhEzxZQS3c/VwQcw1794zI/AAAAAAAADls/RP83Itk48kU-MaiWGCUbNi42r-qT9biaA/s400/1.PNG" width="400" /></a></div><span id="goog_1047918144"></span><span id="goog_1047918145"></span><br /><b>2.</b> Download&nbsp;<a href="https://www.androidfilehost.com/?fid=96042739161891406">gapps-L-4-21-15.zip</a><br /><br /><b>3.</b> Download&nbsp;<a href="https://www.androidfilehost.com/?fid=24052804347835438">benzo-gapps-M-20151011-signed-chroma-r3.zip</a><br /><br /><h4>Installing</h4><div><b>1.</b> Start the Marshmallow image<br /><br /></div><div><b>2. </b>Drag the <i>gapps-L-4-21-15.zip</i> onto the Emulator after it has booted. It will prompt you to install the zip and shutdown the device after that.<br /><br /></div><div class="separator" style="clear: both;"><a href="https://1.bp.blogspot.com/-w7OXUF4cxes/VwQeQYz6k6I/AAAAAAAADmA/5wwxm6pwhAsB6fAsETsTXbt6DvaDOru7g/s1600/2.PNG" imageanchor="1" style="float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="https://1.bp.blogspot.com/-w7OXUF4cxes/VwQeQYz6k6I/AAAAAAAADmA/5wwxm6pwhAsB6fAsETsTXbt6DvaDOru7g/s320/2.PNG" width="165" /></a><a href="https://2.bp.blogspot.com/-OXR4KN59Grk/VwQeQdxGRqI/AAAAAAAADl8/qw3quXqYG2MFLmDEeoOhkPufBwRZHqflw/s1600/3.PNG" imageanchor="1" style="float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="https://2.bp.blogspot.com/-OXR4KN59Grk/VwQeQdxGRqI/AAAAAAAADl8/qw3quXqYG2MFLmDEeoOhkPufBwRZHqflw/s320/3.PNG" width="167" /></a></div><div><br /><div class="separator" style="clear: both;"><b>3.</b> After having install the gapps boot up your Emulator again, it will show a dialog about optimizing newly installed packages.</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-kB8IFSYMm2A/VwQfa1LwCgI/AAAAAAAADmI/ibwjAlxOPIworQChS8LMW_wPtvS3SyfyA/s1600/4.PNG" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="https://4.bp.blogspot.com/-kB8IFSYMm2A/VwQfa1LwCgI/AAAAAAAADmI/ibwjAlxOPIworQChS8LMW_wPtvS3SyfyA/s320/4.PNG" width="167" /></a></div><div class="separator" style="clear: both;"><b>4.</b> Go to <b><i>Settings &gt; Accounts</i></b> and <i><b>Add a Google Account</b></i>. Ignore all crashes.</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;"><a href="https://2.bp.blogspot.com/-gNvTVXc4AWM/VwQf3LyBElI/AAAAAAAADmM/PrWqTj9mIkA0RS6WgL0Zyo1T3gqg8mBrw/s1600/5.PNG" imageanchor="1" style="float: left; margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://2.bp.blogspot.com/-gNvTVXc4AWM/VwQf3LyBElI/AAAAAAAADmM/PrWqTj9mIkA0RS6WgL0Zyo1T3gqg8mBrw/s320/5.PNG" width="167" /></a><a href="https://4.bp.blogspot.com/-FPGgg4k0zeY/VwQf9E_f6GI/AAAAAAAADmU/1V7KDlhobpAghPLY3jCQRVQxOkwAohXsg/s1600/6.PNG" imageanchor="1" style="float: left; margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="https://4.bp.blogspot.com/-FPGgg4k0zeY/VwQf9E_f6GI/AAAAAAAADmU/1V7KDlhobpAghPLY3jCQRVQxOkwAohXsg/s320/6.PNG" width="166" /></a></div><br /><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;"><b>5.</b> After adding the Account, install the&nbsp;<i>benzo-gapps-M-20151011-signed-chroma-r3.zip</i> by dragging it onto your Emulator, like in step 2.</div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;"><b>6.</b> After rebooting after step 5. is done, you should now have working Play Services and Play Store on your Visual Studio Emulator for Android.</div><div class="separator" style="clear: both; text-align: center;"></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-0qTcpXtSAD8/VwQidISQzZI/AAAAAAAADmk/9DlJo1l8uTY2JEhJgoXW3DN39Iz2SWOVA/s1600/8.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="https://3.bp.blogspot.com/-0qTcpXtSAD8/VwQidISQzZI/AAAAAAAADmk/9DlJo1l8uTY2JEhJgoXW3DN39Iz2SWOVA/s640/8.PNG" width="334" /></a></div><div class="separator" style="clear: both;"><br /></div></div>